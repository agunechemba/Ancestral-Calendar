<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ancestral Calendar</title>
<style>
  body {
    font-family: "Segoe UI", Tahoma, sans-serif;
    background: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%);
    margin: 0;
    padding: 30px;
    color: #222;
  }
  h1 {
    text-align: center;
    font-size: 26px;
    margin-bottom: 20px;
    color: #2d3436;
    letter-spacing: 1px;
  }
  .container {
    max-width: 520px;
    margin: 0 auto;
    background: white;
    padding: 24px;
    border-radius: 14px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.08);
    animation: fadeIn 0.8s ease;
  }
  label {
    display: block;
    margin-top: 15px;
    font-weight: 600;
    color: #333;
  }
  select, input[type="date"], button {
    width: 100%;
    padding: 10px;
    margin-top: 6px;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 15px;
    box-sizing: border-box;
    transition: all 0.3s ease;
  }
  select:focus, input[type="date"]:focus {
    border-color: #00b894;
    box-shadow: 0 0 0 3px rgba(0,184,148,0.2);
    outline: none;
  }
  button {
    background: linear-gradient(90deg, #00b894, #0984e3);
    color: white;
    border: none;
    font-weight: bold;
    font-size: 16px;
    cursor: pointer;
    margin-top: 20px;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }
  button:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.15);
  }
  .btn-reset {
    background: linear-gradient(90deg, #d63031, #e17055);
    margin-top: 10px;
  }
  .btn-reset:hover {
    box-shadow: 0 5px 15px rgba(214,48,49,0.3);
  }
  .output {
    margin-top: 20px;
    padding: 20px;
    background: #f1f8ff;
    border: 1px solid #cce5ff;
    border-radius: 10px;
    font-size: 18px;
    text-align: center;
    display: none;
    animation: fadeInUp 0.6s ease;
  }
  .result-day {
    font-size: 22px;
    font-weight: bold;
    color: #00b894;
    text-shadow: 0 0 6px rgba(0, 184, 148, 0.5);
    display: block;
    margin-top: 8px;
  }
  footer {
    font-size: 13px;
    color: #555;
    text-align: center;
    margin-top: 15px;
  }
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }
  @keyframes fadeInUp {
    from { opacity: 0; transform: translateY(15px); }
    to { opacity: 1; transform: translateY(0); }
  }
</style>
</head>
<body>

<h1>Ancestral Calendar</h1>

<div class="container">
  <label for="calendarType">1) Choose calendar type</label>
  <select id="calendarType" onchange="updateDays()">
    <option value="">-- Select Calendar Type --</option>
    <option value="igbo">Igbo</option>
    <option value="yoruba">Yoruba</option>
  </select>

  <label for="referenceDay">2) Ancestral Day for the Reference Date</label>
  <select id="referenceDay" disabled></select>

  <label for="referenceDate">3) Reference Gregorian Date</label>
  <input id="referenceDate" type="date" disabled>

  <label for="targetDate">4) Choose the date you need to know</label>
  <input id="targetDate" type="date" disabled>

  <button id="findBtn" onclick="findMarketDay()" disabled>Find Ancestral Day</button>

  <div id="result" class="output"></div>
  
  <button class="btn-reset" onclick="resetForm()">Reset</button>
</div>

<footer>
  Ancestral Calendar © 2025 <a href="https://agunechemba.github.io" target="blank">Agunechemba Ekene.</a> All rights reserved.
</footer>

<script>
  const calendars = {
    igbo: ["Eke", "Orie", "Afor", "Nkwo"],
    yoruba: ["Ọjọ́ Ifá", "Ọjọ́ Ọ̀rìṣà", "Ọjọ́ Ọ̀ṣun", "Ọjọ́ Ẹ̀bọra"]
  };
  const msPerDay = 24 * 60 * 60 * 1000;

  // Known reference: 12 Aug 2025
  const referenceMap = {
    igbo: { date: "2025-08-12", dayIndex: 1 }, // Orie
    yoruba: { date: "2025-08-12", dayIndex: 1 } // Ọjọ́ Ọ̀rìṣà
  };

  function parseDateAsUTC(dateString) {
    if (!dateString) return null;
    const [year, month, day] = dateString.split('-').map(Number);
    return new Date(Date.UTC(year, month - 1, day));
  }

  function safeModulo(n, m) {
    return ((n % m) + m) % m;
  }

  function formatDateToYYYYMMDD(date) {
    return date.toISOString().split('T')[0];
  }

  function updateDays() {
    const type = document.getElementById('calendarType').value;
    const refDaySelect = document.getElementById('referenceDay');
    const refDateInput = document.getElementById('referenceDate');
    const targetDateInput = document.getElementById('targetDate');
    refDaySelect.innerHTML = "";
    
    if (!type) {
      refDaySelect.disabled = true;
      refDateInput.disabled = true;
      targetDateInput.disabled = true;
      document.getElementById('findBtn').disabled = true;
      return;
    }

    // Populate days for selected calendar
    refDaySelect.innerHTML = calendars[type]
      .map((day, i) => `<option value="${i}">${day}</option>`)
      .join('');

    // Set today's date as default for both inputs
    const today = new Date();
    const todayStr = formatDateToYYYYMMDD(today);
    refDateInput.value = todayStr;
    targetDateInput.value = todayStr;

    // Determine today's ancestral day using known reference mapping
    const baseRef = referenceMap[type];
    const baseRefDate = parseDateAsUTC(baseRef.date);
    const todayUTC = parseDateAsUTC(todayStr);
    const diffDays = Math.round((todayUTC - baseRefDate) / msPerDay);
    const offset = safeModulo(diffDays, 4);
    const todayDayIndex = (baseRef.dayIndex + offset) % 4;

    // Auto-select correct ancestral day
    refDaySelect.value = todayDayIndex;

    // Enable inputs
    refDaySelect.disabled = false;
    refDateInput.disabled = false;
    targetDateInput.disabled = false;
    document.getElementById('findBtn').disabled = false;
  }

  function findMarketDay() {
    const type = document.getElementById('calendarType').value;
    const marketDays = calendars[type];
    const refDayIndex = parseInt(document.getElementById('referenceDay').value);
    const referenceDate = parseDateAsUTC(document.getElementById('referenceDate').value);
    const targetDate = parseDateAsUTC(document.getElementById('targetDate').value);

    if (!referenceDate || !targetDate) {
      alert("Please select both dates.");
      return;
    }

    const diffDays = Math.round((targetDate - referenceDate) / msPerDay);
    const offset = safeModulo(diffDays, 4);
    const targetIndex = (refDayIndex + offset) % 4;
    const resultDay = marketDays[targetIndex];

    const resultDiv = document.getElementById('result');
    resultDiv.innerHTML = `<span class="result-day">${resultDay}</span>`;
    resultDiv.style.display = "block";
  }

  function resetForm() {
    document.getElementById('calendarType').selectedIndex = 0;
    document.getElementById('referenceDay').innerHTML = "";
    document.getElementById('referenceDay').disabled = true;
    document.getElementById('referenceDate').value = "";
    document.getElementById('referenceDate').disabled = true;
    document.getElementById('targetDate').value = "";
    document.getElementById('targetDate').disabled = true;
    document.getElementById('findBtn').disabled = true;
    document.getElementById('result').style.display = "none";
  }
</script>

</body>
</html>
